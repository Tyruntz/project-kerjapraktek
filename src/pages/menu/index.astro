---
import Kategori from "../../components/Kategori.astro";
import Layout from "../../layouts/Layout.astro";
import { supabase } from "../../services/supabase";
import Keranjang from "../../components/Keranjang.jsx";
import CardMenu from "../../components/CardMenu.jsx";
import { useEffect, useState } from "react";


//get data kategori
const { 
   data, 
   error
 } = await supabase.from("kategori").select();
async function getMenuByCategory(categoryId) {
   //get data menu by category
   const { data, error } = await supabase
      .from("menus")
      .select(
         `
      id,
      nama,
      harga_panas,
      harga_dingin,
      kategori_id,
      imageurl
      
    `
      )
      .eq("kategori_id", categoryId);

   if (error) {
      console.error("Error:", error);
      return;
   }

   return data;
}



//fetch data order

---


<Layout title="Menu">
   <header
      class="fixed h-12 top-0 w-full bg-slate-300 flex justify-between items-center p-2"
   >
      <h1>Daftar Menu</h1>
      <Keranjang client:load/>
   </header>
   <div class="mt-[3.5rem]">
      <div class="border-b flex p-1 justsify-end gap-3">
         <input
            class="rounded-md w-full"
            type="search"
            placeholder="Cari Menu"
         />
         <button class="border hover:bg-slate-400 px-5 bg-slate-500 rounded-md"
            >Cari</button
         >
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
         {
            data.map((item, index) => {
               return (
                  <Kategori title={item.nama_kategori}>
                     {getMenuByCategory(item.id).then((data) => {
                        return data.map((menu) => {
                           return (
                              <CardMenu
                                 client:load
                                 id={menu.id}
                                 nama={menu.nama}
                                 hargapanas={menu.harga_panas}
                                 hargadingin={menu.harga_dingin}
                                 imgurl={menu.imageurl}
                              />
                           );
                        });
                     })}
                  </Kategori>
               );
            })
         }
      </div>
   </div>
</Layout>

<style>
   .cart {
      transition: right 0.3s ease-in-out;
   }
   footer {
      flex: 0 0 200px;
   }

   .cart.active {
      right: 0;
   }
   input[type="search"]::-webkit-search-cancel-button {
      -webkit-appearance: none; /* Menghapus tampilan default */
      appearance: none; /* Menghapus tampilan default */
      height: 16px; /* Mengatur tinggi tombol "x" */
      width: 16px; /* Mengatur lebar tombol "x" */
      background: url("src/assets/images/close.png") no-repeat center center; /* Mengatur ikon kustom */
      background-size: contain; /* Mengatur ukuran ikon */
   }
</style>
